# Jafar Unified

Jafar Unified - бу CLI (Command-Line Interface) ва овозли ёрдамчини бирлаштирган интеллектуал ёрдамчи лойиҳаси. Унинг асосий мақсади - фойдаланувчига турли вазифаларни бажаришда, айниқса молиявий бозорларни таҳлил қилишда тезкор ва қулай интерфейсни тақдим этиш.

## Асосий технологиялар

- **Python 3.10:** Лойиҳанинг асосий дастурлаш тили.
- **Google Gemini:** Таҳлиллар, матн генерацияси ва суҳбатлар учун асосий AI модель.
- **Muxlisa AI:** Ўзбек тилидаги нутқни синтез қилиш (Text-to-Speech) ва таниш (Speech-to-Text) учун.
- **Porcupine:** "Джафар" фаоллаштирувчи сўзини аниқлаш учун.
- **Rich:** CLI интерфейсини чиройли ва ўқишга қулай қилиш учун.

## Архитектура

Лойиҳа ягона, тоза Python пакети архитектурасига асосланган. Бу барча импорт муаммоларини ҳал қилади ва кодни тартибли сақлашга ёрдам беради.

- `run.py`: Лойиҳани ишга туширувчи ягона кириш нуқтаси. У овозли ёрдамчини фон режимида ва CLI'ни асосий режимда ишга туширади.
- `jafar/`: Асосий кодлар жойлашган пакет.
  - `cli/`: CLI'га тегишли барча кодлар.
  - `voice/`: Овозли ёрдамчига тегишли кодлар.
  - `utils/`: Иккала қисм учун умумий бўлган ёрдамчи функциялар (API'лар билан ишлаш, конфигурация ва ҳ.к.).
  - `assets/`: Овозли файллар ва бошқа ресурслар.

---

## Ўрнатиш ва ишга тушириш

### 1. Талаблар

- Python 3.10
- `pip` (пакет менежери)

### 2. Ўрнатиш

Лойиҳа директориясига ўтинг ва виртуал муҳитни яратинг:

```bash
cd /path/to/jafar_unified
python3.10 -m venv .venv
```

Виртуал муҳитни фаоллаштиринг ва барча керакли боғлиқликларни ўрнатинг:

```bash
source .venv/bin/activate
pip install -r requirements.txt
```

### 3. Конфигурация

Лойиҳанинг илдиз папкасида (`jafar_unified/`) `.env` номли файл яратинг. Ушбу файлда лойиҳа ишлаши учун зарур бўлган API калитлари ва бошқа созламалар сақланади.

`.env` файлининг намунаси:

```env
# --- AI Models ---
GEMINI_API_KEY="Сизнинг Gemini API калитингиз"

# --- Voice & STT ---
PICOVOICE_ACCESS_KEY="Сизнинг Porcupine калитингиз"
MUXLISA_API_KEY="Сизнинг Muxlisa AI калитингиз"
STT_PROVIDER="muxlisa"

# --- Market Data APIs ---
MARKETAUX_API_TOKEN="Сизнинг Marketaux API калитингиз"
# ва бошқа керакли калитлар...
```

### 4. Ишга тушириш

Барча созламалар киритилгандан сўнг, лойиҳани қуйидаги буйруқ билан ишга туширинг:

```bash
python run.py
```

Бу буйруқ бир вақтнинг ўзида ҳам CLI интерфейсини, ҳам фон режимида "Джафар" сўзини эшитиб турувчи овозли ёрдамчини ишга туширади.

---

## 3. Имкониятлар ва фойдаланиш

### Овозли ассистент (`jafar/voice`)

Овозли ёрдамчи фон режимида ишлайди ва икки усулда фаоллашади.

- **Фаоллаштириш:**
  1.  **"Джафар"** калит сўзини айтиш орқали.
  2.  **PTT (Push-to-Talk):** (Агар GUI мавжуд бўлса) микрофон тугмасини босиш орқали.

- **Асосий буйруқлар:**
  - **"Nima gap", "Yangiliklar":** Интерактив янгиликлар таҳлилини бошлайди. Ёрдамчи сиздан қайси мавзу қизиқтиришини сўрайди.
  - **"Analiz", "Tahlil", "Bozorni ko'r":** `atrade` (супер-анализ) функциясини ишга туширади. Ёрдамчи сиздан қайси молиявий инструментни таҳлил қилишни сўрайди.
  - **"Assalomu aleykum":** Тезкор "Ва алайкум ассалом" жавобини қайтаради.
  - **Бошқа ҳар қандай савол:** Оддий суҳбат режимига ўтади ва саволингизга Google Gemini ёрдамида жавоб беради.

- **Қандай ишлайди:**
  - `jafar_core.py`: Асосий мантиқ шу ерда жойлашган. У фойдаланувчининг буйруғига қараб турли ҳолатларга (`conversation_state`) ўтади (масалан, инструмент номини кутиш, янгилик мавзусини кутиш).
  - `speech.py`: Нутқни таниш ва синтез қилиш учун жавобгар. Ундаги `speak_text` функцияси аввал `assets/audio` папкасидан тайёр аудиофайл бор-йўқлигини текширади, агар топилмаса, Muxlisa AI API'сига мурожаат қилади. Бу тез-тез ишлатиладиган жавоблар учун тезликни ва харажатни камайтиради.

### CLI интерфейси (`jafar/cli`)

CLI (Command-Line Interface) фойдаланувчига матнли буйруқлар орқали лойиҳанинг барча имкониятларидан фойдаланиш имконини беради.

- **Асосий буйруқлар:**
  - `atrade <инструмент>`: Танланган инструмент (масалан, `gold`, `btc`, `eurusd`) учун тўлиқ таҳлил (супер-анализ) тайёрлайди.
  - `analyze`: Интерактив режимда янгиликлар таҳлилини бошлайди.
  - `github <буйруқ>`: Git ва GitHub билан ишлаш учун ёрдамчи буйруқлар.
  - `project <буйруқ>`: Лойиҳалар билан ишлаш учун ёрдамчи буйруқлар.
  - `help`: Барча мавжуд буйруқлар рўйхатини кўрсатади.

- **Қандай ишлайди:**
  - `main.py`: CLI'ни ишга туширади ва фойдаланувчи киритган буйруқни кутади.
  - `command_router.py`: Киритилган буйруқни танийди ва уни тегишли `*_handlers.py` файлидаги функцияга йўналтиради.
  - `*_handlers.py` (масалан, `atrade_handlers.py`): Ҳар бир буйруқнинг аниқ мантиғини бажаради.

---

## 4. Таҳлил методологияси

"Jafar"нинг асосий вазифаси - бу молиявий бозорларни таҳлил қилиш. Бу жараён бир неча босқичдан иборат бўлиб, унда Python'нинг имкониятлари ва "тўғри фикрлаш" (AI учун тўғри савол бериш санъати) бирлашади.

### Маълумот манбалари

Таҳлил учун қуйидаги манбалардан фойдаланилади:

- **Бозор янгиликлари:**
  - **Манба:** `Marketaux API`.
  - **Файл:** `jafar/utils/news_api.py`.
  - **Ишлатилиши:** Танланган инструментга тегишли охирги янгиликларни олади. Бу бозордаги умумий кайфиятни (sentiment) аниқлашга ёрдам беради.

- **Иқтисодий тақвим:**
  - **Манба:** `investing.com` сайтидан парсинг қилинади.
  - **Файл:** `jafar/utils/investing_calendar.py`.
  - **Ишлатилиши:** Яқин кунларда кутилаётган муҳим иқтисодий ҳодисаларни (масалан, ФРС йиғилиши, инфляция кўрсаткичлари) аниқлайди. Бу бозордаги кутилаётган ўзгарувчанликни (volatility) баҳолаш учун керак.

- **Фундаментал омиллар:**
  - **Манба:** Google Gemini'нинг умумий билимлар базаси.
  - **Ишлатилиши:** ФРС қарорлари, геосиёсий вазият, талаб ва таклиф каби узоқ муддатли омилларни таҳлилга қўшиш учун ишлатилади.

- **Техник индикаторлар (Концепция):**
  - **Манба:** (Келажакда қўшилади) `TradingView` ёки бошқа молиявий API'лар.
  - **Ишлатилиши:** RSI (Relative Strength Index), ATR (Average True Range) каби техник кўрсаткичларни ҳисоблаб, нарх ҳаракатининг кучи ва йўналишини баҳолаш учун.

### Таҳлил жараёни ("Тўғри фикрлаш")

"Тўғри фикрлаш" - бу йиғилган хом маълумотларни AI (Gemini) тушунадиган ва ундан сифатли таҳлил чиқариб бера оладиган даражада аниқ ва структурали саволга (промптга) айлантиришдир. Бу жараён `atrade_handlers.py` ичида амалга оширилади.

1.  **Маълумотларни йиғиш:**
    - `get_news()` функцияси орқали охирги 3-5 та энг муҳим янгиликлар олинади.
    - `fetch_economic_calendar_data()` орқали шу ҳафтадаги муҳим иқтисодий воқеалар рўйхати олинади.

2.  **Промптни шакллантириш (Асосий "ақл"):**
    - Барча йиғилган маълумотлар ягона, катта промптга бирлаштирилади. Промпт қуйидаги бўлимлардан иборат бўлади:
      - **Роль:** "Сен профессионал трейдер ва молиявий таҳлилчисан."
      - **Вазифа:** "Қуйидаги маълумотлар асосида `[инструмент номи]` учун батафсил савдо режаси тузиб бер."
      - **Маълумотлар блоки:**
        - **"Охирги янгиликлар":** `get_news()`'дан олинган янгиликлар матни.
        - **"Иқтисодий тақвим":** `fetch_economic_calendar_data()`'дан олинган воқеалар.
      - **Талаблар:** Промптда Gemini'дан айнан нималар талаб қилиниши аниқ кўрсатилади:
        - "Асосий сценарийни (long ёки short) ва унинг сабабларини кўрсат."
        - "Альтернатив сценарийни ҳам тақдим эт."
        - "Кириш нуқталари (entry points), stop-loss ва take-profit даражаларини тавсия қил."
        - "Риск-менежмент қоидаларини эслатиб ўт."
        - "Таҳлилни жадвал кўринишида хулосалаб бер."

3.  **Gemini'дан жавоб олиш:**
    - Тайёрланган промпт `jafar/utils/gemini_api.py`'даги `ask_gemini_text_only` функциясига юборилади.

4.  **Натижани тақдим этиш:**
    - Gemini'дан қайтган матнли таҳлил CLI'да чиройли форматда чоп этилади.
    - Таҳлилнинг муҳим қисмлари (жадвал, хулоса) Telegram'га юборилади.
    - Таҳлилнинг қисқача хулосаси `speak_muxlisa_text` функцияси орқали фойдаланувчига овозли ўқиб берилади.

---

## 5. Ривожлантириш ва яхшилаш

"Jafar Unified" доимий ривожланишдаги лойиҳа. Қуйида унинг келажакдаги ривожланиш йўналишлари ва яхшилаш мумкин бўлган қисмлари келтирилган.

### Нимани яхшилаш мумкин?

- **Техник индикаторларни интеграция қилиш:**
  - **Мақсад:** Таҳлилни фақат фундаментал эмас, балки техник жиҳатдан ҳам кучайтириш.
  - **Йўл:** `tradingview-ta`, `yfinance` каби кутубхоналар ёки `Polygon.io` API'си орқали RSI, ATR, Moving Averages каби индикаторларнинг қийматларини олиб, уларни `atrade` промптига қўшиш.

- **TopstepX API'сини тўлиқ интеграция қилиш:**
  - **Мақсад:** Реал вақтдаги савдо маълумотларини (ҳисоб баланси, очиқ позициялар) олиш ва савдо операцияларини (buy/sell) Jafar орқали бошқариш.
  - **Йўл:** `jafar/utils/topstepx_api_client.py` файлини якунига етказиш ва CLI/овозли буйруқлар орқали унинг функцияларини чақириш.

- **macOS билан чуқурроқ интеграция:**
  - **Мақсад:** Дастурни macOS'нинг "маҳаллий" (native) бир қисмидек ишлайдиган қилиш.
  - **Йўл:** Python'нинг `subprocess` модули орқали macOS'нинг ички буйруқларини ишлатиш:
    - `osascript` орқали таҳлил якунлангани ҳақида билдиришномалар (notifications) юбориш.
    - `say` буйруғи орқали тизим овозидан фойдаланиш (Muxlisa'га альтернатива сифатида).
    - `screencapture` буйруғини `atrade`'га интеграция қилиб, график скриншотларини автоматик олиш.

- **Код сифатини ошириш:**
  - **Мақсад:** Лойиҳани барқарор ва келажакда қўллаб-қувватлаш осон бўлишини таъминлаш.
  - **Йўл:**
    - **Type Hinting:** Барча функция ва ўзгарувчиларга турларини аниқ кўрсатиб чиқиш.
    - **Unit Tests:** `pytest` фреймворки ёрдамида асосий функциялар (масалан, API'лар билан ишлаш, промпт генерацияси) учун тестлар ёзиш.

### Қандай ҳисса қўшиш мумкин?

Лойиҳани ривожлантиришда иштирок этиш учун қуйидагиларга эътибор беринг:

- **Код услуби:** PEP 8 стандартига риоя қилинг.
- **Импортлар:** Импортларни ҳар доим файлнинг энг юқорисига, стандарт кутубхоналар, ташқи кутубхоналар ва маҳаллий импортлар кетма-кетлигида жойлаштиринг.
- **Янги ғоялар:** Янги функциялар, API интеграциялари ёки мавжуд мантиқни яхшилаш бўйича таклифлар ҳар доим қабул қилинади.

---

## Презентация ва README ҳақида

Ушбу `README.md` файли лойиҳанинг техник ҳужжати бўлиб хизмат қилади. У лойиҳанинг ички тузилиши, ишлаш принциплари ва ривожланиш йўналишларини батафсил ёритиб беради.

**Презентация эса лойиҳани ташқи аудиторияга (инвесторлар, потенциал харидорлар) тез ва самарали тақдим этиш учун мўлжалланган.** Унинг асосий мақсади - Jafar'нинг қийматини, муаммони қандай ҳал қилишини ва келажакдаги салоҳиятини қисқа, аниқ ва визуал тарзда етказиш.

**Презентациянинг асосий бўлимлари:**

1.  **Титул варағи:** Jafar: AI-Powered Financial Analyst
2.  **Муаммо:** Молиявий бозорлар — бу ахборот шовқини
3.  **Ечим:** Jafar — Барча маълумотни бир жойда таҳлил қилувчи AI
4.  **Маҳсулот намойиши - `atrade`:** Биргина буйруқ билан тўлиқ савдо режаси
5.  **Маҳсулот намойиши - `analyze`:** Бозор "Нима учун?"ига жавоб
6.  **Уникал хусусиятлар:** Нима учун Jafar бошқалардан ажралиб туради?
7.  **Келажакдаги ривожланиш:** Келажак режаларимиз
8.  **Таклиф:** Кимлар учун?
9.  **Алоқа:** Jafar билан савдоингизни янги босқичга олиб чиқинг

**Эслатма:** Презентацияда матн кам, визуал элементлар (иконкалар, скриншотлар, инфографика) кўп бўлиши керак. Бу унинг самарадорлигини оширади.